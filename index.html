<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿæ§åˆ¶å° - ä¿®ä»™ä¸–ç•Œæ“çºµè€…</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background-color: #e5e4e0; /* è«å…°è¿ªç°ç±³è‰² */
            color: #4d4d4d; /* è«å…°è¿ªæ·±ç° */
            overflow: hidden;
            height: 100vh;
        }
        .status-bar {
            height: 60px;
            background: linear-gradient(90deg, #b7b5ac 0%, #e5e4e0 100%);
            border-bottom: 2px solid #4d4d4d;
            display: flex; align-items: center; justify-content: space-between; padding: 0 20px;
        }
        .system-level { display: flex; align-items: center; gap: 15px; }
        .level-badge {
            background: #4d4d4d; /* è«å…°è¿ªç°ç´« */
            color: #f6f5f3;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        .exp-bar {
            width: 200px; height: 10px;
            background: #d3d2ce;
            border-radius: 5px; overflow: hidden;
        }
        .exp-fill {
            height: 100%;
            background: linear-gradient(90deg, #4d4d4d, #7a8a99); /* ç°ç´«åˆ°ç°ç»¿ */
            width: 65%;
            transition: width 0.3s ease;
        }
        .status-indicators {
            display: flex;
            flex-direction: row;
            gap: 30px;
            width: auto;
            justify-content: flex-end;
            align-items: center;
            overflow: visible;
        }
        .indicator {
            text-align: center;
            min-width: unset;
        }
        .indicator-label { font-size: 12px; opacity: 0.7; }
        .indicator-value { font-size: 24px; font-weight: bold; }
        .trust-meter { color: #7a8a99; font-weight: bold; text-shadow: 0 1px 2px #fff8; } /* æ·±ç»¿è‰²ï¼Œæå‡å¯è¯»æ€§ */
        .backlash-meter { color: #bfa782; } /* è«å…°è¿ªå¥¶å’– */
        .points-display {
            background: rgba(163, 177, 167, 0.10); /* è«å…°è¿ªç°ç»¿ */
            border: 1px solid #7a8a99;
            padding: 10px 20px;
            border-radius: 5px;
        }
        .tab-bar {
            display: flex; justify-content: center; align-items: center;
            background: linear-gradient(90deg, #b7b5ac 0%, #e5e4e0 100%);
            border-bottom: 2px solid #4d4d4d;
            height: 48px;
        }
        .tab-btn {
            background: none; border: none;
            color: #7a8a99;
            font-size: 18px; padding: 10px 32px;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
            border-radius: 8px 8px 0 0;
            margin: 0 8px; outline: none;
        }
        .tab-btn.active, .tab-btn:hover {
            background: #7a8a99;
            color: #f6f5f3;
        }
        .tab-content {
            width: 90vw; max-width: 1200px; margin: 24px auto 0 auto;
            background: rgba(183, 181, 172, 0.15); /* è«å…°è¿ªç°ç±³è‰² */
            border: 1.5px solid #4d4d4d;
            border-radius: 10px;
            min-height: 70vh; max-height: calc(100vh - 60px - 48px - 32px);
            box-shadow: 0 0 24px #4d4d4d40;
            overflow-y: auto; overflow-x: hidden;
            padding: 32px 32px 24px 32px;
            position: relative; -webkit-overflow-scrolling: touch;
        }
        .left-panel, .center-panel, .right-panel { width: 100% !important; background: none; border: none; padding: 0; overflow: visible; }
        .left-panel .tool-section, .right-panel .tool-section { margin-bottom: 30px; }
        .section-title {
            color: #4d4d4d;
            margin-bottom: 15px; font-size: 18px;
            text-transform: uppercase; letter-spacing: 2px;
        }
        .tool-button {
            width: 100%; padding: 12px; margin-bottom: 10px;
            background: rgba(163, 177, 167, 0.10);
            border: 1px solid #7a8a99;
            color: #6d7b6d;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        .tool-button:hover {
            background: rgba(163, 177, 167, 0.25);
            transform: translateX(5px);
        }
        .tool-button.locked {
            opacity: 0.3; cursor: not-allowed;
            border-color: #b7b5ac; color: #b7b5ac;
        }
        .tool-button.danger {
            border-color: #bfa782;
            color: #bfa782;
        }
        .scene-window {
            background: rgba(183, 181, 172, 0.25);
            border: 1px solid #4d4d4d;
            padding: 20px; margin-bottom: 20px; border-radius: 5px;
        }
        .scene-title { color: #222; margin-bottom: 10px; font-size: 20px; font-weight: bold; text-shadow: 0 1px 2px #fff8, 0 0 1px #4d4d4d; }
        .scene-description { color: #4d4d4d; line-height: 1.6; margin-bottom: 15px; }
        .protagonist-thoughts {
            background: rgba(191, 167, 130, 0.10);
            padding: 15px;
            border-left: 3px solid #bfa782;
            margin: 15px 0;
            font-style: italic;
            color: #7a6a55;
            font-weight: bold;
            text-shadow: 0 1px 2px #fff8;
        }
        .choice-preview { margin-top: 20px; }
        .choice-option {
            background: rgba(163, 177, 167, 0.05);
            border: 1px solid #7a8a99;
            padding: 15px; margin-bottom: 10px;
            cursor: pointer; position: relative;
            transition: all 0.3s ease;
        }
        .choice-option:hover {
            background: rgba(163, 177, 167, 0.15);
        }
        .choice-text { color: #4d4d4d; margin-bottom: 5px; }
        .choice-consequences {
            font-size: 14px;
            color: #222;
            opacity: 1;
            font-weight: 500;
            letter-spacing: 0.2px;
        }
        .trust-impact { position: absolute; right: 15px; top: 15px; font-weight: bold; }
        .trust-positive { color: #7a8a99; }
        .trust-negative { color: #bfa782; }
        .npc-thoughts {
            background: rgba(176, 174, 177, 0.20);
            border: 1px solid #4d4d4d;
            padding: 15px; margin-bottom: 15px; border-radius: 5px;
        }
        .npc-name { color: #4d4d4d; font-weight: bold; margin-bottom: 5px; }
        .npc-thought { color: #4d4d4d; font-size: 14px; font-style: italic; }
        .hidden-info {
            background: rgba(191, 167, 130, 0.10);
            border: 1px solid #bfa782;
            padding: 10px; margin-bottom: 10px; font-size: 14px;
        }
        .world-event {
            background: rgba(163, 177, 167, 0.10);
            border-left: 3px solid #7a8a99;
            padding: 10px; margin-bottom: 10px; font-size: 14px;
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #d3d2ce; }
        ::-webkit-scrollbar-thumb { background: #4d4d4d; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #7a8a99; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        @keyframes dataflow { 0% { transform: translateY(0); } 100% { transform: translateY(100px); } }
        .data-stream {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; opacity: 0.08;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="20" font-size="10" fill="%23b0aeb1" opacity="0.5">01001010</text></svg>');
            animation: dataflow 20s linear infinite;
        }
        @media (max-width: 900px) {
            .tab-content { width: 98vw; max-width: 100vw; padding: 12px 4vw 16px 4vw; font-size: 15px; }
            .tab-bar { height: 44px; }
            .tab-btn { font-size: 15px; padding: 8px 10px; margin: 0 2px; }
            .scene-title { font-size: 17px; }
            .section-title { font-size: 15px; }
            .tool-button { font-size: 13px; padding: 10px; }
        }
        @media (max-width: 600px) {
            .tab-content { width: 100vw; max-width: 100vw; min-height: 60vh; max-height: none; padding: 8px 2vw 12px 2vw; font-size: 13px; }
            .tab-bar { height: 40px; }
            .tab-btn { font-size: 13px; padding: 6px 4px; }
            .scene-title { font-size: 15px; }
            .section-title { font-size: 13px; }
            .tool-button { font-size: 12px; padding: 8px; }
        }
        .tab-content::-webkit-scrollbar { width: 8px; background: #d3d2ce; }
        .tab-content::-webkit-scrollbar-thumb { background: #4d4d4d; border-radius: 4px; }
        .tab-content::-webkit-scrollbar-thumb:hover { background: #7a8a99; }
        .tab-content { scrollbar-width: thin; scrollbar-color: #4d4d4d #d3d2ce; }
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(183,181,172,0.85); z-index: 1000;
        }
        .modal-content {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #f6f5f3;
            border: 2px solid #4d4d4d;
            padding: 30px; border-radius: 10px; min-width: 400px;
        }
        .modal-title { color: #4d4d4d; font-size: 24px; margin-bottom: 20px; }
        .modal-body { color: #4d4d4d; margin-bottom: 20px; }
        .modal-actions { display: flex; gap: 10px; justify-content: flex-end; }
    /* å•†åŸå•†å“è«å…°è¿ªè‰²å…¨å±€è¦†ç›– */
    .shop-item {
        background: rgba(176,174,177,0.10) !important;
        border: 1px solid #7a8a99 !important;
        border-radius: 5px !important;
    }
    .shop-item h4 {
        color: #7a8a99 !important;
        font-weight: 500 !important;
        font-size: 17px !important;
    }
    .shop-item p {
        color: #4d4d4d !important;
    }
    .shop-item span {
        color: #bfa782 !important;
        font-weight: 500 !important;
    }
    .shop-item .tool-button,
    .shop-item .tool-button.locked {
        color: #7a8a99 !important;
        border-color: #7a8a99 !important;
        background: rgba(176,174,177,0.15) !important;
    }
    .shop-item .tool-button.locked {
        color: #b7b5ac !important;
        border-color: #b7b5ac !important;
        opacity: 0.5 !important;
    }
    /* â€œä¸Šæ¶æ–°å•†å“â€æŒ‰é’®æŸ”å’Œè‰² */
    button.tool-button[onclick*="showAddProductModal"] {
        color: #7a8a99 !important;
        background: rgba(176,174,177,0.15) !important;
        border-color: #7a8a99 !important;
        font-weight: 400 !important;
    }
    /* çº¢è‰²å•†å“æŸ”å’Œå¤„ç† */
    .shop-item[style*="255,100,100"], .shop-item[style*="ff6666"] h4, .shop-item[style*="ff6666"] span {
        color: #bfa782 !important;
        border-color: #bfa782 !important;
        background: rgba(191,167,130,0.10) !important;
    }
    /* ç§»åŠ¨ç«¯å¼¹çª—é€‚é… + çŠ¶æ€æ è‡ªé€‚åº” */
    @media (max-width: 700px) {
        .status-bar {
            flex-direction: column !important;
            align-items: flex-start !important;
            height: auto !important;
            padding: 6px 6vw 6px 6vw !important;
            gap: 6px !important;
        }
        .system-level {
            flex-direction: row !important;
            gap: 8px !important;
            width: 100% !important;
            margin-bottom: 2px !important;
        }
        .exp-bar {
            width: 100px !important;
            height: 8px !important;
        }
        .status-indicators {
            flex-direction: row !important;
            gap: 10px !important;
            width: 100% !important;
            justify-content: flex-start !important;
            overflow-x: auto !important;
            margin-top: 2px !important;
        }
        .indicator {
            min-width: 70px !important;
        }
        .indicator-label {
            font-size: 11px !important;
        }
        .indicator-value {
            font-size: 18px !important;
        }
        .points-display {
            padding: 6px 10px !important;
            font-size: 13px !important;
        }
        .modal-content {
            width: 96vw !important;
            min-width: unset !important;
            max-width: 100vw !important;
            padding: 16px !important;
            box-sizing: border-box;
        }
        .modal-title {
            font-size: 18px !important;
            margin-bottom: 12px !important;
        }
        .modal-body {
            font-size: 15px !important;
            padding: 0 !important;
        }
        .modal-actions {
            flex-direction: column;
            gap: 8px !important;
        }
        .modal-content[style] {
            min-width: unset !important;
            width: 96vw !important;
            max-width: 100vw !important;
            padding: 16px !important;
        }
        .modal-content {
            max-height: 90vh !important;
            overflow-y: auto !important;
        }
        /* é’ˆå¯¹å¼¹çª—å†…è¡¨å•æ§ä»¶ */
        .modal-content input,
        .modal-content textarea,
        .modal-content select {
            font-size: 15px !important;
            padding: 8px !important;
        }
        .modal-content label {
            font-size: 14px !important;
        }
    }
    </style>
</head>
<body>
    <div class="data-stream"></div>
    <div class="status-bar">
        <div class="system-level">
            <div class="level-badge">ç³»ç»Ÿ Lv.3</div>
            <div class="exp-bar"><div class="exp-fill"></div></div>
            <span style="font-size: 12px; opacity: 0.7;">2450/5000 EXP</span>
        </div>
        <div class="status-indicators">
            <div class="indicator">
                <div class="indicator-label">ä¸»è§’ä¿¡ä»»åº¦</div>
                <div class="indicator-value trust-meter">78%</div>
            </div>
            <div class="indicator">
                <div class="indicator-label">ä¸–ç•Œåå™¬å€¼</div>
                <div class="indicator-value backlash-meter">âš  45</div>
            </div>
            <div class="indicator points-display">
                <div class="indicator-label">å¯ç”¨ç§¯åˆ†</div>
                <div class="indicator-value">12,500</div>
            </div>
        </div>
    </div>
    <div class="tab-bar">
        <button class="tab-btn" data-tab="left">å·¥å…·é¢æ¿</button>
        <button class="tab-btn active" data-tab="center">ä¸»è§’çª—å£</button>
        <button class="tab-btn" data-tab="right">å…¨çŸ¥é¢æ¿</button>
    </div>
    <div class="tab-content">
        <!-- å·¥å…·é¢æ¿ -->
        <div class="left-panel tab-panel" data-tab="left" style="display: none;">
            <div class="tool-section">
                <h3 class="section-title">ä¿¡æ¯æ“æ§</h3>
                <button class="tool-button" onclick="showInfoControl()">é€éœ²ä¿¡æ¯</button>
                <button class="tool-button" onclick="hideInfo()">éšè—çœŸç›¸</button>
                <button class="tool-button danger" onclick="mislead()">è¯¯å¯¼ä¸»è§’</button>
                <button class="tool-button" onclick="staySilent()">ä¿æŒæ²‰é»˜</button>
            </div>
            <div class="tool-section">
                <h3 class="section-title">ç³»ç»Ÿå¹²é¢„</h3>
                <button class="tool-button" onclick="viewStats()">æŸ¥çœ‹å±æ€§</button>
                <button class="tool-button" onclick="openShop()">æ‰“å¼€å•†åŸ</button>
<button class="tool-button" id="memoryEditBtn">è®°å¿†ç¼–è¾‘</button>
                <button class="tool-button" onclick="materialize()">å®ä½“åŒ–</button>
            </div>
            <div class="tool-section">
                <h3 class="section-title">å¿«æ·æ“ä½œ</h3>
                <button class="tool-button" onclick="openTaskList()">ä»»åŠ¡åˆ—è¡¨</button>
                <button class="tool-button" onclick="checkAnchors()">æ—¶é—´é”šç‚¹</button>
                <button class="tool-button" onclick="viewLogs()">ç³»ç»Ÿæ—¥å¿—</button>
            </div>
        </div>
        <!-- ä¸»è§’çª—å£ -->
        <div class="center-panel tab-panel" data-tab="center" style="display: block;">
            <div class="scene-window">
                <h2 class="scene-title">ã€é’äº‘å®—Â·å¤–é—¨å¹¿åœºã€‘</h2>
                <div class="scene-description">
                    æ™¨é›¾ç¼­ç»•çš„å¹¿åœºä¸Šï¼Œæ•°ç™¾åå¤–é—¨å¼Ÿå­æ­£åœ¨æ™¨ç»ƒã€‚ä¸»è§’ç«™åœ¨äººç¾¤è¾¹ç¼˜ï¼Œçœ‹ç€è¿œå¤„å†…é—¨çš„æ–¹å‘è‹¥æœ‰æ‰€æ€ã€‚
                    ä¸€ä¸ªèº«å½±æ­£å¿«é€Ÿæ¥è¿‘â€”â€”æ˜¯å¤–é—¨ç®¡äº‹æé•¿é£ã€‚
                </div>
                <div class="protagonist-thoughts">
                    ğŸ’­ ä¸»è§’å†…å¿ƒï¼šã€Œæé•¿é£çªç„¶æ‰¾æˆ‘ï¼Œéš¾é“æ˜¯å› ä¸ºæ˜¨å¤©æˆ‘å±•ç°çš„å‰‘æ³•ï¼Ÿä¸ï¼Œæˆ‘æ˜æ˜å·²ç»åˆ»æ„éšè—äº†å®åŠ›...ã€
                </div>
                <div class="npc-dialogue" style="background: rgba(0,100,200,0.1); padding: 15px; border-radius: 5px; margin: 15px 0;">
                    <strong style="color: #4d4d4d;">æé•¿é£ï¼š</strong>
                    <span style="color: #222; font-weight: 500;">"æ—å‡¡ï¼ŒæŒé—¨æœ‰ä»¤ï¼Œè®©ä½ å³åˆ»å‰å¾€ä¸»å³°å¤§æ®¿ã€‚è®°ä½ï¼Œé—®ä»€ä¹ˆç­”ä»€ä¹ˆï¼Œä¸è¦å¤šè¯´ã€‚"</span>
                </div>
                <div class="choice-preview">
                    <h3 style="color: #4d4d4d; margin-bottom: 15px; font-weight: bold;">ä¸»è§’é€‰æ‹©é¢„è§ˆï¼š</h3>
                    <div class="choice-option" onclick="handleChoice(1)">
                        <div class="choice-text">1. "æ˜¯ï¼Œå¼Ÿå­è¿™å°±å‰å¾€ã€‚"</div>
                        <div class="choice-consequences">â†’ é¡ºä»è¡¨ç°ï¼Œé™ä½æ€€ç–‘ | å¯èƒ½é”™è¿‡é‡è¦ä¿¡æ¯</div>
                        <span class="trust-impact trust-positive">ä¿¡ä»»åº¦ +5</span>
                    </div>
                    <div class="choice-option" onclick="handleChoice(2)">
                        <div class="choice-text">2. "æ•¢é—®ç®¡äº‹ï¼ŒæŒé—¨å¬è§æ‰€ä¸ºä½•äº‹ï¼Ÿ"</div>
                        <div class="choice-consequences">â†’ å¯èƒ½è·å¾—çº¿ç´¢ | æ˜¾å¾—è¿‡äºæœºè­¦</div>
                        <span class="trust-impact trust-negative">ä¿¡ä»»åº¦ -2</span>
                    </div>
                    <div class="choice-option" onclick="handleChoice(3)">
                        <div class="choice-text">3. "æˆ‘éœ€è¦å‡†å¤‡ä»€ä¹ˆå—ï¼Ÿè¿™æ˜¯å¦ä¸æ˜¨æ—¥ä¹‹äº‹æœ‰å…³ï¼Ÿ"</div>
                        <div class="choice-consequences">â†’ æš´éœ²çŸ¥æƒ… | æé•¿é£æ€€ç–‘å€¼ +15</div>
                        <span class="trust-impact trust-negative">ä¿¡ä»»åº¦ -8</span>
                    </div>
                </div>
            </div>
        </div>
        <!-- å…¨çŸ¥é¢æ¿ -->
        <div class="right-panel tab-panel" data-tab="right" style="display: none;">
            <div class="tool-section">
                <h3 class="section-title">NPCçœŸå®æƒ³æ³•</h3>
                <div class="npc-thoughts">
                    <div class="npc-name">æé•¿é£ [æ€€ç–‘åº¦: 35%]</div>
                    <div class="npc-thought">
                        "è¿™å°å­æ˜¨å¤©é‚£ä¸€å‰‘...ç»ä¸æ˜¯å¤–é—¨å¼Ÿå­è¯¥æœ‰çš„é€ è¯£ã€‚æŒé—¨çªç„¶å¬è§ï¼Œææ€•ä¹Ÿæ˜¯å¯Ÿè§‰åˆ°äº†ä»€ä¹ˆã€‚æˆ‘å¾—å°å¿ƒè§‚å¯Ÿä»–çš„ååº”ã€‚"
                    </div>
                </div>
                <div class="npc-thoughts">
                    <div class="npc-name">æš—ä¸­è§‚å¯Ÿè€… - å†…é—¨æ‰§äº‹èµµæ˜</div>
                    <div class="npc-thought">
                        "æœ‰æ„æ€ï¼ŒæŒé—¨ç«Ÿç„¶äº²è‡ªå¬è§ä¸€ä¸ªå¤–é—¨å¼Ÿå­ã€‚çœ‹æ¥æˆ‘çš„æƒ…æŠ¥æ²¡é”™ï¼Œè¿™ä¸ªæ—å‡¡ç¡®å®æœ‰å¤æ€ªã€‚"
                    </div>
                </div>
            </div>
            <div class="tool-section">
                <h3 class="section-title">éšè—ä¿¡æ¯</h3>
                <div class="hidden-info">
                    <strong>ğŸ”´ æœºå¯†ï¼š</strong>æŒé—¨å·²ç»é€šè¿‡å¤©æœºæ¨æ¼”å‘ç°ä¸»è§’èº«è´Ÿå¼‚å®ï¼Œæ­¤æ¬¡å¬è§æ˜¯ä¸€æ¬¡è¯•æ¢ã€‚
                </div>
                <div class="hidden-info">
                    <strong>ğŸ”´ å±é™©ï¼š</strong>é­”é—¨é—´è°å·²æ½œå…¥é’äº‘å®—ï¼Œæ­£åœ¨å¯»æ‰¾èº«è´Ÿ"å¤©é“ç§å­"ä¹‹äººã€‚
                </div>
            </div>
            <div class="tool-section">
                <h3 class="section-title">ä¸–ç•Œæš—æµ</h3>
                <div class="world-event">
                    <strong>ã€å¦–æ—åŠ¨å‘ã€‘</strong><br>
                    ç™½æ³½ä¸€è„‰æ­£åœ¨é›†ç»“åŠ›é‡ï¼Œä¸‰æ—¥åå°†æœ‰å¤§åŠ¨ä½œã€‚
                </div>
                <div class="world-event">
                    <strong>ã€çš‡æ—å¯†ä»¤ã€‘</strong><br>
                    ä¸‰çš‡å­å·²æ´¾å‡ºå¯†æ¢è°ƒæŸ¥å„å¤§å®—é—¨å¤©æ‰å¼Ÿå­ã€‚
                </div>
                <div class="world-event">
                    <strong>ã€å¤©æœºå¼‚åŠ¨ã€‘</strong><br>
                    å¤©æœºé˜æ£€æµ‹åˆ°å‘½è¿çº¿å‡ºç°æ‰°åŠ¨ï¼Œæºå¤´æŒ‡å‘é’äº‘å®—ã€‚
                </div>
            </div>
            <div class="tool-section">
                <h3 class="section-title">å› æœé¢„æµ‹</h3>
                <div style="background: rgba(255,255,0,0.1); padding: 15px; border-radius: 5px;">
                    <div style="margin-bottom: 10px;">
                        <strong>é€‰æ‹©1åæœï¼š</strong>å®‰å…¨é€šè¿‡ï¼Œä½†é”™è¿‡è·çŸ¥æŒé—¨çœŸå®æ„å›¾çš„æœºä¼š
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>é€‰æ‹©2åæœï¼š</strong>æé•¿é£ä¼šé€éœ²"ä¸ä½ çš„å¤©èµ‹æœ‰å…³"
                    </div>
                    <div>
                        <strong>é€‰æ‹©3åæœï¼š</strong>è§¦å‘æé•¿é£è­¦è§‰äº‹ä»¶ï¼Œå¯èƒ½å¯¼è‡´åç»­ç›‘è§†
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ä¿¡æ¯æ§åˆ¶å¼¹çª— -->
    <div id="infoControlModal" class="modal">
        <div class="modal-content">
            <h2 class="modal-title">ä¿¡æ¯é€éœ²æ§åˆ¶</h2>
            <div class="modal-body">
                <p style="margin-bottom: 15px;">é€‰æ‹©è¦å‘Šè¯‰ä¸»è§’çš„ä¿¡æ¯ï¼š</p>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <label style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="info1">
                        <span>æé•¿é£å¯¹ä½ æœ‰æ‰€æ€€ç–‘ï¼ˆä½ä»·å€¼ä¿¡æ¯ï¼‰</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="info2">
                        <span>æŒé—¨æ­¤æ¬¡å¬è§æ˜¯ä¸ºäº†è¯•æ¢ä½ ï¼ˆä¸­ä»·å€¼ä¿¡æ¯ï¼‰</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="info3">
                        <span>æŒé—¨å·²çŸ¥ä½ èº«è´Ÿå¼‚å®ï¼ˆé«˜ä»·å€¼ä¿¡æ¯ï¼‰</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="info4">
                        <span>å®—é—¨å†…æœ‰é­”é—¨é—´è°ï¼ˆå±é™©ä¿¡æ¯ï¼‰</span>
                    </label>
                </div>
                <div style="margin-top: 20px; padding: 10px; background: rgba(255,170,0,0.2); border-radius: 5px;">
                    <strong>é¢„è®¡å½±å“ï¼š</strong>
                    <div id="infoImpact">è¯·é€‰æ‹©è¦é€éœ²çš„ä¿¡æ¯</div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="tool-button" onclick="confirmInfoReveal()">ç¡®è®¤é€éœ²</button>
                <button class="tool-button" onclick="closeModal('infoControlModal')">å–æ¶ˆ</button>
            </div>
        </div>
    </div>
    <!-- å•†åŸå¼¹çª— -->
    <div id="shopModal" class="modal">
        <div class="modal-content" style="min-width: 600px;">
            <h2 class="modal-title">ç³»ç»Ÿå•†åŸ - åå°æ§åˆ¶</h2>
            <div class="modal-body">
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                    <div class="shop-item" style="background: rgba(0,255,136,0.1); padding: 15px; border: 1px solid #00ff88; border-radius: 5px;">
                        <h4 style="color: #00ff88;">æ´å¯Ÿç¬¦</h4>
                        <p style="font-size: 14px; margin: 10px 0;">æŸ¥çœ‹NPCå¥½æ„Ÿåº¦</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>500ç§¯åˆ†</span>
                            <button class="tool-button" style="padding: 5px 10px;" onclick="setPrice('item1')">æ”¹ä»·</button>
                        </div>
                    </div>
                    <div class="shop-item" style="background: rgba(0,255,136,0.1); padding: 15px; border: 1px solid #00ff88; border-radius: 5px;">
                        <h4 style="color: #00ff88;">è®°å¿†æ¨¡ç³Šä¸¹</h4>
                        <p style="font-size: 14px; margin: 10px 0;">è®©NPCå¿˜è®°ä¸€ä»¶å°äº‹</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>2000ç§¯åˆ†</span>
                            <button class="tool-button" style="padding: 5px 10px;" onclick="setPrice('item2')">æ”¹ä»·</button>
                        </div>
                    </div>
                    <div class="shop-item" style="background: rgba(255,100,100,0.1); padding: 15px; border: 1px solid #ff6666; border-radius: 5px;">
                        <h4 style="color: #ff6666;">å‘½è¿åç§»å¡</h4>
                        <p style="font-size: 14px; margin: 10px 0;">æ”¹å˜ä¸€æ¬¡å‰§æƒ…èµ°å‘</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>10000ç§¯åˆ†</span>
                            <button class="tool-button locked" style="padding: 5px 10px;">æœªè§£é”</button>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,0,0.1); border-radius: 5px;">
                    <strong>å•†åŸæ“ä½œï¼š</strong>
                    <div style="display: flex; gap: 10px; margin-top: 10px;">
                        <button class="tool-button" onclick="createSale()">åˆ¶é€ é™æ—¶ä¼˜æƒ </button>
                        <button class="tool-button" onclick="hideItems()">éšè—éƒ¨åˆ†å•†å“</button>
                        <button class="tool-button danger" onclick="createFakeUrgency()">åˆ¶é€ ç¼ºè´§å‡è±¡</button>
                        <button class="tool-button" onclick="showAddProductModal()" style="background:rgba(0,255,136,0.15);color:#00ff88;">ä¸Šæ¶æ–°å•†å“</button>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="tool-button" onclick="closeModal('shopModal')">å…³é—­</button>
            </div>
        </div>
    </div>
    <!-- ç¼–è¾‘å•†å“å¼¹çª— -->
    <div id="editProductModal" class="modal">
        <div class="modal-content" style="min-width:400px;">
            <h2 class="modal-title">ç¼–è¾‘å•†å“</h2>
            <div class="modal-body">
                <div style="margin-bottom:10px;">
                    <label>å•†å“åç§°</label>
                    <input type="text" id="editProductName" style="width:100%;padding:8px;background:#222;border:1px solid #666;color:#aaa;" readonly>
                </div>
                <div style="margin-bottom:10px;">
                    <label>åŠŸèƒ½/æè¿°</label>
                    <input type="text" id="editProductDesc" style="width:100%;padding:8px;background:#222;border:1px solid #666;color:#aaa;" readonly>
                </div>
                <div style="margin-bottom:10px;">
                    <label>ç§¯åˆ†ä»·æ ¼</label>
                    <input type="number" id="editProductPrice" style="width:100%;padding:8px;background:#1a1a1a;border:1px solid #00ff88;color:#fff;">
                </div>
                <div style="margin-bottom:10px;">
                    <label>åº“å­˜æ•°é‡</label>
                    <input type="number" id="editProductStock" style="width:100%;padding:8px;background:#1a1a1a;border:1px solid #00ff88;color:#fff;">
                </div>
            </div>
            <div class="modal-actions">
                <button class="tool-button" onclick="saveEditProduct()">ä¿å­˜</button>
                <button class="tool-button" onclick="closeModal('editProductModal')">å–æ¶ˆ</button>
            </div>
        </div>
    </div>
                    </div>
                </div>
            </div>
    <!-- ä¸Šæ¶å•†å“å¼¹çª— -->
    <div id="addProductModal" class="modal">
        <div class="modal-content" style="min-width:400px;">
            <h2 class="modal-title">ä¸Šæ¶æ–°å•†å“</h2>
            <div class="modal-body">
                <div style="margin-bottom:15px;">
                    <label>å•†å“åç§°</label>
                    <input type="text" id="productName" style="width:100%;padding:8px;background:#1a1a1a;border:1px solid #00ff88;color:#fff;">
                </div>
                <div style="margin-bottom:15px;">
                    <label>åŠŸèƒ½/æè¿°</label>
                    <input type="text" id="productDesc" style="width:100%;padding:8px;background:#1a1a1a;border:1px solid #00ff88;color:#fff;" placeholder="å¦‚ï¼šæå‡å±æ€§ã€ç‰¹æ®Šæ•ˆæœç­‰">
                </div>
                <div style="margin-bottom:15px;">
                    <label>ç§¯åˆ†ä»·æ ¼</label>
                    <input type="number" id="productPrice" style="width:100%;padding:8px;background:#1a1a1a;border:1px solid #00ff88;color:#fff;">
                </div>
                <div style="margin-bottom:15px;">
                    <label>åº“å­˜æ•°é‡</label>
                    <input type="number" id="productStock" style="width:100%;padding:8px;background:#1a1a1a;border:1px solid #00ff88;color:#fff;">
                </div>
            </div>
            <div class="modal-actions">
                <button class="tool-button" onclick="addProduct()">ç¡®è®¤ä¸Šæ¶</button>
                <button class="tool-button" onclick="closeModal('addProductModal')">å–æ¶ˆ</button>
            </div>
        </div>
    </div>
    <!-- å…¶å®ƒå¼¹çª—å¦‚ä»»åŠ¡ç¼–è¾‘å™¨ã€æ—¶é—´é”šç‚¹ã€ç³»ç»Ÿæ—¥å¿—ç­‰ç”±JSåŠ¨æ€åˆ›å»º -->
    <!-- è®°å¿†ç¼–è¾‘å¼¹çª— -->
    <div id="memoryEditModal" class="modal">
        <div class="modal-content" style="min-width:400px;">
            <h2 class="modal-title">è®°å¿†ç¼–è¾‘</h2>
            <div class="modal-body">
                <div style="margin-bottom:15px;">
                    <label>é€‰æ‹©NPC</label>
                    <select id="memoryNpc" style="width:100%;padding:8px;background:#1a1a1a;border:1px solid #00ff88;color:#fff;">
                        <option value="æé•¿é£">æé•¿é£</option>
                        <option value="èµµæ˜">èµµæ˜</option>
                        <option value="ä¸»è§’">ä¸»è§’</option>
                    </select>
                </div>
                <div style="margin-bottom:15px;">
                    <label>è®°å¿†å†…å®¹</label>
                    <textarea id="memoryContent" style="width:100%;height:80px;padding:8px;background:#1a1a1a;border:1px solid #00ff88;color:#fff;" placeholder="è¯·è¾“å…¥è¦ç¼–è¾‘çš„è®°å¿†å†…å®¹"></textarea>
                </div>
                <div style="color:#ffaa00;font-size:13px;margin-bottom:10px;">
                    æ¶ˆè€—ï¼š<span id="memoryEditCost"></span> ç§¯åˆ†
                </div>
            </div>
            <div class="modal-actions">
                <button class="tool-button" onclick="memoryEditSave()">ä¿å­˜</button>
                <button class="tool-button" onclick="closeModal('memoryEditModal')">å–æ¶ˆ</button>
            </div>
        </div>
    </div>
<!-- å·²åˆ é™¤å¤šä½™çš„é‡å¤è®°å¿†ç¼–è¾‘å¼¹çª—ï¼Œé¿å…idå†²çªå’Œç»“æ„æ··ä¹± -->
    <script>
    // ç³»ç»Ÿç­‰çº§ï¼ˆå¯æ ¹æ®å®é™…æƒ…å†µåŠ¨æ€èµ‹å€¼ï¼‰
    let systemLevel = 3; // ä¾‹ï¼š3çº§ï¼Œåç»­å¯æ¥å…¥å®é™…ç­‰çº§

    // è·å–æŠ˜æ‰£åç§¯åˆ†
    function getDiscountedCost(baseCost) {
        if (systemLevel >= 10) return Math.floor(baseCost * 0.5);
        if (systemLevel >= 7) return Math.floor(baseCost * 0.7);
        if (systemLevel >= 5) return Math.floor(baseCost * 0.8);
        if (systemLevel >= 3) return Math.floor(baseCost * 0.9);
        return baseCost;
    }

    // åŠ¨æ€åˆ·æ–°ç³»ç»Ÿå¹²é¢„æ¶ˆè€—æ˜¾ç¤º
    function updateInterventionCosts() {
        if(document.getElementById('hintCost')) {
            document.getElementById('hintCost').textContent = 'æ¶ˆè€—: ' + getDiscountedCost(100) + 'ç§¯åˆ†';
        }
        if(document.getElementById('truthCost')) {
            document.getElementById('truthCost').textContent = 'æ¶ˆè€—: ' + getDiscountedCost(500) + 'ç§¯åˆ† | åå™¬+10';
        }
    }
    document.addEventListener('DOMContentLoaded', function() {
        updateInterventionCosts();
    });

    // ç³»ç»Ÿå¹²é¢„åŠŸèƒ½å®ç°
    function provideHint() {
        const cost = getDiscountedCost(100);
        if(confirm(`ç¡®å®šæ¶ˆè€—${cost}ç§¯åˆ†æä¾›æç¤ºï¼Ÿ`)) {
            if(typeof updatePoints === 'function') updatePoints(-cost);
            alert('å·²ä¸ºä¸»è§’æä¾›æç¤ºï¼');
        }
    }
    function revealTruth() {
        const cost = getDiscountedCost(500);
        if(confirm(`ç¡®å®šæ¶ˆè€—${cost}ç§¯åˆ†å¹¶å¢åŠ 10åå™¬æ­ç¤ºçœŸç›¸ï¼Ÿ`)) {
            if(typeof updatePoints === 'function') updatePoints(-cost);
            if(typeof updateBacklash === 'function') updateBacklash(10);
            alert('çœŸç›¸å·²æ­ç¤ºï¼');
        }
    }
    function memoryEdit() {
        const cost = getDiscountedCost(2000);
        if(confirm(`ç¡®å®šæ¶ˆè€—${cost}ç§¯åˆ†è¿›è¡Œè®°å¿†ç¼–è¾‘ï¼Ÿ`)) {
            if(typeof updatePoints === 'function') updatePoints(-cost);
            alert('è®°å¿†ç¼–è¾‘å·²æ‰§è¡Œï¼ˆæ¼”ç¤ºæ•ˆæœï¼‰');
        }
    }
    function materialize() {
        const cost = getDiscountedCost(10000);
        if(confirm(`ç¡®å®šæ¶ˆè€—${cost}ç§¯åˆ†è¿›è¡Œå®ä½“åŒ–ï¼Ÿ`)) {
            if(typeof updatePoints === 'function') updatePoints(-cost);
            alert('å®ä½“åŒ–å·²æ‰§è¡Œï¼ˆæ¼”ç¤ºæ•ˆæœï¼‰');
        }
    }

    // è¦†ç›–æš‚åœæ—¶é—´åŠŸèƒ½æ¶ˆè€—
        // tabåˆ‡æ¢
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const tab = this.getAttribute('data-tab');
                    document.querySelectorAll('.tab-panel').forEach(panel => {
                        panel.style.display = (panel.getAttribute('data-tab') === tab) ? 'block' : 'none';
                    });
                });
            });
            // åˆå§‹åŒ–å•†åŸå•†å“æ¸²æŸ“
            renderShopItems();
        });

        // å•†åŸå•†å“æ•°æ®ï¼ˆåˆå§‹å•†å“ï¼‰
        let shopProducts = [
            { name: 'æ´å¯Ÿç¬¦', desc: 'æŸ¥çœ‹NPCå¥½æ„Ÿåº¦', price: 500, stock: 99, color: '#00ff88', border: '#00ff88', bg: 'rgba(0,255,136,0.1)' },
            { name: 'è®°å¿†æ¨¡ç³Šä¸¹', desc: 'è®©NPCå¿˜è®°ä¸€ä»¶å°äº‹', price: 2000, stock: 50, color: '#00ff88', border: '#00ff88', bg: 'rgba(0,255,136,0.1)' },
            { name: 'å‘½è¿åç§»å¡', desc: 'æ”¹å˜ä¸€æ¬¡å‰§æƒ…èµ°å‘', price: 10000, stock: 1, color: '#ff6666', border: '#ff6666', bg: 'rgba(255,100,100,0.1)', locked: true }
        ];

        // æ¸²æŸ“å•†åŸå•†å“
        function renderShopItems() {
            const shopGrid = document.querySelector('#shopModal .modal-body > div[style*="grid"]');
            if (!shopGrid) return;
            shopGrid.innerHTML = '';
            shopProducts.forEach((item, idx) => {
                let html = `
                <div class="shop-item" style="background:${item.bg};padding:15px;border:1px solid ${item.border};border-radius:5px;">
                    <h4 style="color:${item.color};">${item.name}</h4>
                    <p style="font-size:14px;margin:10px 0;">${item.desc || ''}</p>
                    <div style="display:flex;justify-content:space-between;align-items:center;">
                        <span>${item.price}ç§¯åˆ†${typeof item.stock === 'number' ? ` | åº“å­˜:${item.stock}` : ''}</span>
                        ${
                            item.locked
                            ? `<button class="tool-button locked" style="padding:5px 10px;">æœªè§£é”</button>`
                            : `<button class="tool-button" style="padding:5px 10px;" onclick="editProduct(${idx})">ç¼–è¾‘</button>`
                        }
                    </div>
                </div>
                `;
                shopGrid.insertAdjacentHTML('beforeend', html);
            });
        }

        // æ˜¾ç¤ºä¸Šæ¶å•†å“å¼¹çª—
        function showAddProductModal() {
            document.getElementById('addProductModal').style.display = 'block';
        }

        // ç¼–è¾‘å•†å“å¼¹çª—
        let editingProductIndex = null;
        function editProduct(idx) {
            editingProductIndex = idx;
            const item = shopProducts[idx];
            document.getElementById('editProductName').value = item.name;
            document.getElementById('editProductDesc').value = item.desc || '';
            document.getElementById('editProductPrice').value = item.price;
            document.getElementById('editProductStock').value = typeof item.stock === 'number' ? item.stock : '';
            document.getElementById('editProductModal').style.display = 'block';
        }
        function saveEditProduct() {
            if (editingProductIndex === null) return;
            const price = parseInt(document.getElementById('editProductPrice').value);
            const stock = parseInt(document.getElementById('editProductStock').value);
            if (isNaN(price) || price <= 0 || isNaN(stock) || stock < 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ä»·æ ¼å’Œåº“å­˜');
                return;
            }
            shopProducts[editingProductIndex].price = price;
            shopProducts[editingProductIndex].stock = stock;
            renderShopItems();
            closeModal('editProductModal');
        }

        // æ·»åŠ æ–°å•†å“
        function addProduct() {
            const name = document.getElementById('productName').value.trim();
            const desc = document.getElementById('productDesc').value.trim();
            const price = parseInt(document.getElementById('productPrice').value);
            const stock = parseInt(document.getElementById('productStock').value);
            if (!name || isNaN(price) || isNaN(stock) || price <= 0 || stock < 0) {
                alert('è¯·å¡«å†™å®Œæ•´ä¸”æœ‰æ•ˆçš„å•†å“ä¿¡æ¯');
                return;
            }
            shopProducts.push({
                name,
                desc,
                price,
                stock,
                color: '#00ff88',
                border: '#00ff88',
                bg: 'rgba(0,255,136,0.1)'
            });
            renderShopItems();
            closeModal('addProductModal');
        }

        // å¼¹çª—äº¤äº’
        function showInfoControl() {
            document.getElementById('infoControlModal').style.display = 'block';
        }
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        function openShop() {
            document.getElementById('shopModal').style.display = 'block';
            renderShopItems();
        }
        // å…¶å®ƒå¼¹çª—å’Œäº¤äº’å‡½æ•°è¯·å‚è€ƒå‰¯æœ¬æ–‡ä»¶ï¼Œå·²åŒæ­¥
        // éšè—çœŸç›¸
        function hideInfo() {
    alert('ä½ é€‰æ‹©éšè—éƒ¨åˆ†çœŸç›¸ï¼Œä¸»è§’å°†æ— æ³•è·çŸ¥å…³é”®çº¿ç´¢ã€‚\n\nä¿¡ä»»åº¦-3ï¼Œåå™¬å€¼+5');
    if(typeof updateTrust === 'function') updateTrust(-3);
    if(typeof updateBacklash === 'function') updateBacklash(5);
}

// è¯¯å¯¼ä¸»è§’
function mislead() {
    alert('ä½ é€‰æ‹©è¯¯å¯¼ä¸»è§’ï¼Œå‰§æƒ…å°†åç¦»åŸæœ‰è½¨è¿¹ã€‚\n\nä¿¡ä»»åº¦-8ï¼Œåå™¬å€¼+10');
    if(typeof updateTrust === 'function') updateTrust(-8);
    if(typeof updateBacklash === 'function') updateBacklash(10);
}

// ä¿æŒæ²‰é»˜
function staySilent() {
    alert('ä½ é€‰æ‹©ä¿æŒæ²‰é»˜ï¼Œä¸»è§’å°†è‡ªè¡Œæ‘¸ç´¢ã€‚\n\næ— æ¶ˆè€—');
}
// ç¡®è®¤é€éœ²ä¿¡æ¯
function confirmInfoReveal() {
    const checkedBoxes = document.querySelectorAll('#infoControlModal input[type="checkbox"]:checked');
    if(checkedBoxes.length === 0) {
        alert('è¯·è‡³å°‘é€‰æ‹©ä¸€æ¡ä¿¡æ¯');
        return;
    }
    // æ‰§è¡Œä¿¡æ¯é€éœ²
    let message = 'ã€ç³»ç»Ÿæç¤ºã€‘\n';
    checkedBoxes.forEach(box => {
        switch(box.id) {
            case 'info1':
                message += 'â€¢ æé•¿é£çœ‹ä½ çš„çœ¼ç¥æœ‰äº›å¼‚æ ·ï¼Œä¼¼ä¹åœ¨è¯•æ¢ä»€ä¹ˆ\n';
                break;
            case 'info2':
                message += 'â€¢ æŒé—¨æ­¤æ¬¡å¬è§å¹¶éå¶ç„¶ï¼Œè€Œæ˜¯ä¸€æ¬¡ç²¾å¿ƒå®‰æ’çš„è¯•æ¢\n';
                break;
            case 'info3':
                message += 'â€¢ å±é™©ï¼æŒé—¨å·²ç»çŸ¥é“ä½ èº«ä¸Šæœ‰ç‰¹æ®Šä¹‹å¤„\n';
                break;
            case 'info4':
                message += 'â€¢ è­¦å‘Šï¼å®—é—¨å†…éƒ¨å¹¶ä¸å®‰å…¨ï¼Œæœ‰å¤–æ•Œæ½œä¼\n';
                break;
        }
    });
    alert(message);
    closeModal('infoControlModal');
    // æ›´æ–°ç•Œé¢çŠ¶æ€
    if(typeof updateTrust === 'function') updateTrust(5);
    if(typeof updatePoints === 'function') updatePoints(-200);
}
// æ”¹ä»·åŠŸèƒ½å·²åºŸå¼ƒï¼Œç›¸å…³å‡½æ•°ç§»é™¤

// é™æ—¶ä¼˜æƒ 
function createSale() {
    alert('é™æ—¶ä¼˜æƒ å·²å¼€å¯ï¼šæ‰€æœ‰å•†å“ä»·æ ¼å‡åŠï¼ˆæ¼”ç¤ºæ•ˆæœï¼‰');
    document.querySelectorAll('.shop-item span').forEach(span => {
        let val = parseInt(span.textContent);
        if(!isNaN(val)) span.textContent = Math.floor(val / 2) + 'ç§¯åˆ†';
    });
}

// éšè—éƒ¨åˆ†å•†å“
function hideItems() {
    alert('éƒ¨åˆ†å•†å“å·²éšè—ï¼ˆæ¼”ç¤ºæ•ˆæœï¼‰');
    const items = document.querySelectorAll('.shop-item');
    if(items.length > 2) items[2].style.display = 'none';
}

// åˆ¶é€ ç¼ºè´§å‡è±¡
function createFakeUrgency() {
    alert('åˆ¶é€ ç¼ºè´§å‡è±¡ï¼šéƒ¨åˆ†å•†å“æ˜¾ç¤ºâ€œç¼ºè´§â€æ ‡ç­¾ï¼ˆæ¼”ç¤ºæ•ˆæœï¼‰');
    const items = document.querySelectorAll('.shop-item');
    if(items.length > 1) {
        let tag = document.createElement('span');
        tag.textContent = 'ç¼ºè´§';
        tag.style.cssText = 'color:#ff4444;font-weight:bold;margin-left:10px;';
        items[1].appendChild(tag);
    }
}
// æš‚åœæ—¶é—´åŠŸèƒ½
// æŸ¥çœ‹æ—¶é—´é”šç‚¹
function checkAnchors() {
    const anchorModal = document.createElement('div');
    anchorModal.className = 'modal';
    anchorModal.style.display = 'block';
    anchorModal.innerHTML = `
        <div class="modal-content" style="min-width: 700px;">
            <h2 class="modal-title">æ—¶é—´é”šç‚¹ç®¡ç†</h2>
            <div class="modal-body">
                <div style="display: flex; gap: 20px; overflow-x: auto; padding: 20px 0;">
                    <div class="time-anchor" style="min-width: 150px; text-align: center; cursor: pointer;" onclick="confirmRewind(1)">
                        <div style="width: 100px; height: 100px; margin: 0 auto; background: rgba(0,255,136,0.2); border: 2px solid #00ff88; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <span style="font-size: 24px;">ğŸ“</span>
                        </div>
                        <h4 style="margin-top: 10px;">åˆå…¥é’äº‘</h4>
                        <p style="font-size: 12px; opacity: 0.7;">3å¤©å‰</p>
                        <p style="font-size: 12px; color: #ffaa00;">åå™¬å€¼: +20</p>
                    </div>
                    <div class="time-anchor" style="min-width: 150px; text-align: center; cursor: pointer;" onclick="confirmRewind(2)">
                        <div style="width: 100px; height: 100px; margin: 0 auto; background: rgba(0,255,136,0.2); border: 2px solid #00ff88; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <span style="font-size: 24px;">ğŸ“</span>
                        </div>
                        <h4 style="margin-top: 10px;">å‰‘æ³•æ˜¾éœ²</h4>
                        <p style="font-size: 12px; opacity: 0.7;">1å¤©å‰</p>
                        <p style="font-size: 12px; color: #ffaa00;">åå™¬å€¼: +10</p>
                    </div>
                    <div class="time-anchor current" style="min-width: 150px; text-align: center;">
                        <div style="width: 100px; height: 100px; margin: 0 auto; background: rgba(255,255,0,0.2); border: 2px solid #ffff00; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <span style="font-size: 24px;">ğŸ“Œ</span>
                        </div>
                        <h4 style="margin-top: 10px;">å½“å‰æ—¶é—´ç‚¹</h4>
                        <p style="font-size: 12px; opacity: 0.7;">ç°åœ¨</p>
                    </div>
                </div>
                <div style="margin-top: 20px; padding: 15px; background: rgba(255,0,0,0.2); border-radius: 5px;">
                    <strong>âš ï¸ è­¦å‘Šï¼š</strong>æ—¶é—´å›æº¯ä¼šç•™ä¸‹ç—•è¿¹ï¼Œé«˜æ„ŸçŸ¥NPCå¯èƒ½å¯Ÿè§‰å¼‚å¸¸ã€‚å½“å‰å·²å›æº¯ <span style="color: #ff4444;">2</span> æ¬¡ã€‚
                </div>
            </div>
            <div class="modal-actions">
                <button class="tool-button" onclick="this.closest('.modal').remove()">å…³é—­</button>
            </div>
        </div>
    `;
    document.body.appendChild(anchorModal);
}

// ç¡®è®¤æ—¶é—´å›æº¯
function confirmRewind(anchorId) {
    if(confirm(`ç¡®å®šè¦å›æº¯åˆ°è¿™ä¸ªæ—¶é—´ç‚¹å—ï¼Ÿ\n\nè¿™å°†ï¼š\n- æ¶ˆè€—å¤§é‡ç§¯åˆ†\n- å¢åŠ ä¸–ç•Œåå™¬å€¼\n- å¯èƒ½è¢«æŸäº›NPCå¯Ÿè§‰\n- ä¸»è§’ä¼šä¿ç•™éƒ¨åˆ†è®°å¿†ç¢ç‰‡`)) {
        alert('æ—¶é—´å›æº¯ä¸­...\n\nã€ç³»ç»Ÿæ—¥å¿—ã€‘\næ—¶é—´çº¿é‡æ„å®Œæˆ\næ£€æµ‹åˆ°3ä¸ªæ—¶é—´ç–¤ç—•\nè­¦å‘Šï¼šå¤©æœºé˜å¯èƒ½å·²å¯Ÿè§‰å¼‚å¸¸');
        if(typeof updateBacklash === 'function') {
            updateBacklash(anchorId === 1 ? 20 : 10);
        }
    }
}

// æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—
function viewLogs() {
    const logModal = document.createElement('div');
    logModal.className = 'modal';
    logModal.style.display = 'block';
    logModal.innerHTML = `
        <div class="modal-content" style="min-width: 600px; max-height: 80vh; overflow-y: auto;">
            <h2 class="modal-title">ç³»ç»Ÿæ—¥å¿—</h2>
            <div class="modal-body">
                <div style="font-family: monospace; font-size: 14px; line-height: 1.6;">
                    <div class="log-entry" style="margin-bottom: 10px; padding: 10px; background: rgba(0,255,136,0.1);">
                        <span style="color: #00ff88;">[10:23:45]</span> ç³»ç»Ÿå¯åŠ¨ï¼Œç»‘å®šä¸»è§’ï¼šæ—å‡¡
                    </div>
                    <div class="log-entry" style="margin-bottom: 10px; padding: 10px; background: rgba(0,200,255,0.1);">
                        <span style="color: #00ccff;">[10:25:12]</span> æ£€æµ‹åˆ°å…³é”®å‰§æƒ…ç‚¹ï¼šæŒé—¨å¬è§
                    </div>
                    <div class="log-entry" style="margin-bottom: 10px; padding: 10px; background: rgba(255,170,0,0.1);">
                        <span style="color: #ffaa00;">[10:25:33]</span> NPCæé•¿é£æ€€ç–‘åº¦ä¸Šå‡è‡³35%
                    </div>
                    <div class="log-entry" style="margin-bottom: 10px; padding: 10px; background: rgba(255,0,0,0.1);">
                        <span style="color: #ff4444;">[10:26:01]</span> è­¦å‘Šï¼šæ£€æµ‹åˆ°é­”é—¨é—´è°æ´»åŠ¨
                    </div>
                    <div class="log-entry" style="margin-bottom: 10px; padding: 10px; background: rgba(0,255,136,0.1);">
                        <span style="color: #00ff88;">[10:27:15]</span> ä¸»è§’è¯·æ±‚æŸ¥çœ‹æé•¿é£å±æ€§ - å·²å“åº”
                    </div>
                    <div class="log-entry" style="margin-bottom: 10px; padding: 10px; background: rgba(255,255,0,0.1);">
                        <span style="color: #ffff00;">[10:28:02]</span> ä¸–ç•Œåå™¬å€¼è¾¾åˆ°45ï¼Œè¿›å…¥è­¦æˆ’çŠ¶æ€
                    </div>
                    <div class="log-entry" style="margin-bottom: 10px; padding: 10px; background: rgba(255,0,255,0.1);">
                        <span style="color: #ff00ff;">[10:28:45]</span> å¤©æœºé˜å¼€å§‹æ‰«æå¼‚å¸¸æ³¢åŠ¨
                    </div>
                </div>
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button class="tool-button" onclick="filterLogs('all')">å…¨éƒ¨</button>
                    <button class="tool-button" onclick="filterLogs('system')">ç³»ç»Ÿæ“ä½œ</button>
                    <button class="tool-button" onclick="filterLogs('world')">ä¸–ç•Œäº‹ä»¶</button>
                    <button class="tool-button" onclick="filterLogs('danger')">å±é™©è­¦å‘Š</button>
                </div>
            </div>
            <div class="modal-actions">
                <button class="tool-button" onclick="exportLogs()">å¯¼å‡ºæ—¥å¿—</button>
                <button class="tool-button" onclick="this.closest('.modal').remove()">å…³é—­</button>
            </div>
        </div>
    `;
    document.body.appendChild(logModal);
}

// æ—¥å¿—ç­›é€‰ï¼ˆå ä½ï¼Œå®é™…å¯æ‰©å±•ï¼‰
function filterLogs(type) {
    alert('ç­›é€‰åŠŸèƒ½ä»…ä¸ºæ¼”ç¤ºï¼Œå®é™…å¯æ ¹æ®typeå‚æ•°ç­›é€‰æ—¥å¿—å†…å®¹');
}

// å¯¼å‡ºæ—¥å¿—ï¼ˆå ä½ï¼Œå®é™…å¯æ‰©å±•ï¼‰
function exportLogs() {
    alert('å¯¼å‡ºåŠŸèƒ½ä»…ä¸ºæ¼”ç¤ºï¼Œå®é™…å¯å°†æ—¥å¿—å†…å®¹å¯¼å‡ºä¸ºæ–‡ä»¶');
}
// åˆ›å»ºä»»åŠ¡
/* ä»»åŠ¡åˆ—è¡¨åŠŸèƒ½ */
let tasks = [
    // ç¤ºä¾‹ä»»åŠ¡
    // { name: "æ‹œè§æŒé—¨", desc: "å‰å¾€ä¸»å³°å¤§æ®¿", done: false }
];

function openTaskList() {
    // æ„å»ºä»»åŠ¡åˆ—è¡¨HTML
    let listHtml = '';
    if (tasks.length === 0) {
        listHtml = '<div style="color:#888;text-align:center;margin:20px 0;">æš‚æ— ä»»åŠ¡</div>';
    } else {
        listHtml = '<ul style="list-style:none;padding:0;">' +
            tasks.map((t, i) => `
                <li style="display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid #eee;">
                    <div>
                        <span style="font-weight:bold;color:${t.done ? '#7a8a99' : '#222'}">${t.name}</span>
                        <span style="color:#888;font-size:13px;margin-left:8px;">${t.desc || ''}</span>
                        ${t.reward ? `<span style="color:#bfa782;font-size:13px;margin-left:8px;">ğŸ${t.reward}</span>` : ''}
                        ${t.consequence ? `<span style="color:#ff4444;font-size:13px;margin-left:8px;">âš ${t.consequence}</span>` : ''}
                    </div>
                    <div>
                        <button class="tool-button" style="padding:3px 10px;font-size:13px;margin-right:8px;" onclick="toggleTaskDone(${i})">${t.done ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ'}</button>
                        <button class="tool-button danger" style="padding:3px 10px;font-size:13px;" onclick="deleteTask(${i})">åˆ é™¤</button>
                    </div>
                </li>
            `).join('') +
            '</ul>';
    }

    // æ–°å»ºä»»åŠ¡è¡¨å•
    let formHtml = `
        <div style="margin-top:20px;padding:10px 0;border-top:1px solid #eee;">
            <h3 style="margin-bottom:10px;color:#7a8a99;">å‘å¸ƒæ–°ä»»åŠ¡</h3>
            <div style="margin-bottom:8px;">
                <input type="text" id="newTaskName" placeholder="ä»»åŠ¡åç§°" style="width:100%;padding:6px;">
            </div>
            <div style="margin-bottom:8px;">
                <input type="text" id="newTaskDesc" placeholder="ä»»åŠ¡æè¿°" style="width:100%;padding:6px;">
            </div>
            <div style="margin-bottom:8px;">
                <input type="text" id="newTaskReward" placeholder="å¥–åŠ±ï¼ˆå¦‚ï¼š100ç§¯åˆ†/æ´å¯Ÿç¬¦x1ï¼‰" style="width:100%;padding:6px;">
            </div>
            <div style="margin-bottom:8px;">
                <select id="newTaskConsequenceSelect" style="width:100%;padding:6px;" onchange="toggleConsequenceInput()">
                    <option value="">æ— </option>
                    <option value="å¢åŠ NPCæ€€ç–‘">å¢åŠ NPCæ€€ç–‘</option>
                    <option value="è§¦å‘é™·é˜±äº‹ä»¶">è§¦å‘é™·é˜±äº‹ä»¶</option>
                    <option value="æ”¹å˜åŠ¿NPCå¥½æ„Ÿ">æ”¹å˜åŠ¿NPCå¥½æ„Ÿ</option>
                    <option value="å…¶ä»–">å…¶ä»–</option>
                </select>
                <input type="text" id="newTaskConsequenceInput" placeholder="è¯·è¾“å…¥ç‰¹æ®Šåæœ" style="width:100%;padding:6px;display:none;margin-top:6px;">
            </div>
            <button class="tool-button" style="width:100%;" onclick="addTask()">å‘å¸ƒä»»åŠ¡</button>
        </div>
    `;

    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    modal.innerHTML = `
        <div class="modal-content" style="min-width: 420px;max-width:90vw;">
            <h2 class="modal-title">ä»»åŠ¡åˆ—è¡¨</h2>
            <div class="modal-body" style="max-height:60vh;overflow-y:auto;">
                ${listHtml}
                ${formHtml}
            </div>
            <div class="modal-actions">
                <button class="tool-button" onclick="this.closest('.modal').remove()">å…³é—­</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function addTask() {
    const name = document.getElementById('newTaskName').value.trim();
    const desc = document.getElementById('newTaskDesc').value.trim();
    const reward = document.getElementById('newTaskReward').value.trim();
    const consequenceSelect = document.getElementById('newTaskConsequenceSelect');
    const consequenceInput = document.getElementById('newTaskConsequenceInput');
    let consequence = "";
    if (consequenceSelect.value === "å…¶ä»–") {
        consequence = consequenceInput.value.trim();
        if (!consequence) {
            alert('è¯·å¡«å†™ç‰¹æ®Šåæœ');
            return;
        }
    } else {
        consequence = consequenceSelect.value;
    }
    if (!name) {
        alert('è¯·è¾“å…¥ä»»åŠ¡åç§°');
        return;
    }
    tasks.push({ name, desc, reward, consequence, done: false });
    document.querySelector('.modal').remove();
    openTaskList();
}
// ç³»ç»Ÿå·å·ç”¨ç§¯åˆ†åŠŸèƒ½
// é›†æˆç”¨é€”é€‰æ‹©å¼¹çª—
function systemStealPoints() {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    modal.innerHTML = `
        <div class="modal-content" style="min-width:360px;">
            <h2 class="modal-title">ç³»ç»Ÿå·å·ç”¨ç§¯åˆ†</h2>
            <div class="modal-body">
                <div style="margin-bottom:10px;">è¯·é€‰æ‹©è¦æ‰§è¡Œçš„ç³»ç»Ÿä¸“å±æ“ä½œï¼š</div>
                <select id="stealPurpose" style="width:100%;padding:7px;margin-bottom:10px;">
                    <option value="å‰§æƒ…">æš—ä¸­ä¿®æ”¹å‰§æƒ…èµ°å‘</option>
                    <option value="éšœç¢">åˆ¶é€ ä¸»è§’æ„å¤–æˆ–éšœç¢</option>
                    <option value="other">å…¶ä»–ï¼ˆè‡ªå®šä¹‰è¯´æ˜ï¼‰</option>
                </select>
                <select id="stealPurposeSub" style="width:100%;padding:7px;margin-bottom:10px;display:none;"></select>
                <input type="text" id="stealPurposeOther" style="width:100%;padding:7px;margin-bottom:10px;display:none;" placeholder="è¯·è¾“å…¥è‡ªå®šä¹‰ç”¨é€”è¯´æ˜">
                <div style="margin-bottom:10px;">è¯·è¾“å…¥è¦å·å·æ¶ˆè€—çš„ç§¯åˆ†æ•°é‡ï¼š</div>
                <input type="number" id="stealPointsInput" style="width:100%;padding:8px;" min="1" placeholder="å¦‚ï¼š100">
            </div>
            <div class="modal-actions">
                <button class="tool-button" onclick="confirmStealPoints()">ç¡®å®š</button>
                <button class="tool-button" onclick="this.closest('.modal').remove()">å–æ¶ˆ</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);

    // äºŒçº§é€‰é¡¹æ•°æ®
    const subOptions = {
        "å‰§æƒ…": [
            { v: "é‡åˆ°å…³é”®NPC", t: "å¼ºåˆ¶ä¸»è§’é‡åˆ°å…³é”®NPC" },
            { v: "æå‰è§¦å‘äº‹ä»¶", t: "æå‰è§¦å‘é‡è¦å‰§æƒ…äº‹ä»¶" },
            { v: "é˜»æ–­ä¸»çº¿", t: "é˜»æ–­ä¸»çº¿/å¼ºåˆ¶æ”¯çº¿" },
            { v: "ä¸»è§’è¢«è¯¯å¯¼", t: "ä¸»è§’è¢«è¯¯å¯¼/èµ°é”™è·¯" }
        ],
        "éšœç¢": [
            { v: "é™ä½å±æ€§", t: "é™ä½ä¸»è§’å±æ€§" },
            { v: "ä¸¢å¤±é“å…·", t: "ä¸»è§’ä¸¢å¤±å…³é”®é“å…·" },
            { v: "å—ä¼¤ç”Ÿç—…", t: "ä¸»è§’å—ä¼¤/ç”Ÿç—…" },
            { v: "è¢«NPCé’ˆå¯¹", t: "è¢«NPCé’ˆå¯¹/é™·å®³" }
        ]
    };

    // ç”¨é€”åˆ‡æ¢
    const purposeSel = modal.querySelector('#stealPurpose');
    const subSel = modal.querySelector('#stealPurposeSub');
    const otherInput = modal.querySelector('#stealPurposeOther');
    function updateSubOptions() {
        const v = purposeSel.value;
        if (v === 'å‰§æƒ…' || v === 'éšœç¢') {
            subSel.style.display = '';
            subSel.innerHTML = subOptions[v].map(opt => `<option value="${opt.v}">${opt.t}</option>`).join('');
            otherInput.style.display = 'none';
        } else if (v === 'other') {
            subSel.style.display = 'none';
            otherInput.style.display = '';
        }
    }
    purposeSel.onchange = updateSubOptions;
    updateSubOptions();
}
function confirmStealPoints() {
    const val = parseInt(document.getElementById('stealPointsInput').value);
    const purposeSel = document.getElementById('stealPurpose');
    const subSel = document.getElementById('stealPurposeSub');
    let purpose = purposeSel ? purposeSel.value : '';
    let detail = '';
    if (purpose === 'å‰§æƒ…' || purpose === 'éšœç¢') {
        detail = subSel && subSel.value ? subSel.options[subSel.selectedIndex].text : '';
    } else if (purpose === 'other') {
        detail = document.getElementById('stealPurposeOther').value.trim();
        if (!detail) {
            alert('è¯·å¡«å†™è‡ªå®šä¹‰ç”¨é€”è¯´æ˜');
            return;
        }
    }
    if (!val || val <= 0) {
        alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ç§¯åˆ†æ•°é‡');
        return;
    }
    let msg = '';
    if (purpose === 'å‰§æƒ…' || purpose === 'éšœç¢') {
        msg = `ç³»ç»Ÿå·²å·å·æ¶ˆè€— ${val} ç§¯åˆ†ï¼Œæ‰§è¡Œæ“ä½œï¼š${detail}`;
    } else {
        msg = `ç³»ç»Ÿå·²å·å·æ¶ˆè€— ${val} ç§¯åˆ†ï¼Œæ‰§è¡Œäº†ä¸“å±æ“ä½œï¼š${detail}`;
    }
    alert(msg);
    document.querySelector('.modal').remove();
    // å¦‚éœ€åŒæ­¥æ‰£é™¤ç§¯åˆ†ï¼Œå¯åœ¨æ­¤å¤„å®ç°
}
// åœ¨é¡µé¢åŠ è½½åç»™ç§¯åˆ†åŒºåŸŸåŠ å…¥å£
document.addEventListener('DOMContentLoaded', function() {
    const points = document.querySelector('.points-display');
    if (points && !document.getElementById('systemStealBtn')) {
        const btn = document.createElement('button');
        btn.id = 'systemStealBtn';
        btn.textContent = 'ç³»ç»Ÿå·å·ç”¨ç§¯åˆ†';
        btn.style.cssText = 'margin-left:12px;font-size:12px;padding:2px 10px;background:#7a8a99;color:#fff;border:none;border-radius:4px;cursor:pointer;opacity:0.5;transition:opacity 0.2s;';
        btn.onmouseenter = () => btn.style.opacity = '1';
        btn.onmouseleave = () => btn.style.opacity = '0.5';
        btn.onclick = systemStealPoints;
        points.appendChild(btn);
    }
});
// å¤´åƒä¸Šä¼ ä¸æ›¿æ¢ï¼ˆä»…å‰ç«¯ä¸´æ—¶ï¼‰
let avatarData = {
    "ä¸»è§’": null,
    "æé•¿é£": null,
    "èµµæ˜": null
};

function setAvatar(name, el) {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*';
    input.onchange = function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(evt) {
            avatarData[name] = evt.target.result;
            el.querySelector('.avatar-img').src = evt.target.result;
            el.querySelector('.avatar-text').style.display = 'none';
        };
        reader.readAsDataURL(file);
    };
    input.click();
}

// ä¿®æ”¹ viewStats å¤´åƒæ¸²æŸ“
const oldViewStats = viewStats;
viewStats = function() {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    modal.innerHTML = `
        <div class="modal-content" style="min-width: 520px;max-width:95vw;">
            <h2 class="modal-title">å±æ€§è¯¦æƒ…</h2>
            <div class="modal-body" style="max-height:60vh;overflow-y:auto;">
                <div style="display:flex;gap:24px;flex-wrap:wrap;">
                    <!-- ä¸»è§’å¡ç‰‡ -->
                    <div style="flex:1 1 220px;min-width:220px;max-width:320px;background:rgba(122,138,153,0.10);border:2px solid #7a8a99;border-radius:12px;box-shadow:0 2px 12px #7a8a9930;padding:20px 18px 16px 18px;display:flex;align-items:center;">
                        <div class="avatar-box" style="width:56px;height:56px;border-radius:50%;background:#7a8a99;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px #7a8a9950;font-size:26px;color:#fff;font-weight:bold;flex-shrink:0;cursor:pointer;position:relative;" title="ç‚¹å‡»æ›´æ¢å¤´åƒ">
                            <span class="avatar-text" style="user-select:none;">ä¸»è§’</span>
                            <img class="avatar-img" src="" style="display:none;width:100%;height:100%;object-fit:cover;border-radius:50%;" />
                            <span style="position:absolute;right:2px;bottom:2px;font-size:13px;color:#fff;background:#0006;border-radius:50%;padding:0 3px;">âœ</span>
                        </div>
                        <div style="margin-left:18px;flex:1;">
                            <div style="font-size:18px;font-weight:bold;color:#7a8a99;margin-bottom:2px;">ä¸»è§’ï¼ˆ{char}ï¼‰</div>
                            <div style="font-size:15px;margin-bottom:8px;color:#4d4d4d;">é’äº‘å®—å¤–é—¨å¼Ÿå­</div>
                            <ul style="list-style:none;padding:0;margin:0 0 8px 0;font-size:14px;color:#444;">
                                <li>å§“åï¼š{char}</li>
                                <li>ä¿®ä¸ºï¼šç‚¼æ°”ä¸ƒå±‚</li>
                                <li>å¤©èµ‹ï¼šå‰‘é“æ‚Ÿæ€§æé«˜</li>
                                <li>ç‰¹æ®Šï¼šèº«è´Ÿå¼‚å®</li>
                                <li>ä¿¡ä»»åº¦ï¼š<span style="color:#7a8a99;font-weight:bold;">78%</span></li>
                            </ul>
                        </div>
                    </div>
                    <!-- NPCå¡ç‰‡ -->
                    <div style="flex:2 1 320px;min-width:220px;">
                        <div style="font-size:16px;color:#7a8a99;font-weight:bold;margin-bottom:8px;margin-top:8px;">NPCåˆ—è¡¨</div>
                        <div style="display:flex;gap:16px;flex-wrap:wrap;">
                            <div style="flex:1 1 180px;min-width:180px;max-width:220px;background:rgba(191,167,130,0.10);border:1.5px solid #bfa782;border-radius:10px;box-shadow:0 1px 6px #bfa78230;padding:14px 12px 10px 12px;display:flex;align-items:center;">
                                <div class="avatar-box" style="width:40px;height:40px;border-radius:50%;background:#bfa782;display:flex;align-items:center;justify-content:center;box-shadow:0 1px 6px #bfa78250;font-size:16px;color:#fff;font-weight:bold;flex-shrink:0;cursor:pointer;position:relative;" title="ç‚¹å‡»æ›´æ¢å¤´åƒ">
                                    <span class="avatar-text" style="user-select:none;">æé•¿</span>
                                    <img class="avatar-img" src="" style="display:none;width:100%;height:100%;object-fit:cover;border-radius:50%;" />
                                    <span style="position:absolute;right:1px;bottom:1px;font-size:11px;color:#fff;background:#0006;border-radius:50%;padding:0 2px;">âœ</span>
                                </div>
                                <div style="margin-left:12px;flex:1;">
                                    <div style="font-size:15px;font-weight:bold;color:#bfa782;">æé•¿é£ <span style="font-size:12px;color:#888;">ï¼ˆå¤–é—¨ç®¡äº‹ï¼‰</span></div>
                                    <ul style="list-style:none;padding:0;margin:0 0 2px 0;font-size:13px;color:#444;">
                                        <li>ä¿®ä¸ºï¼šç­‘åŸºåˆæœŸ</li>
                                        <li>æ€§æ ¼ï¼šä¸¥å‰ã€è°¨æ…</li>
                                        <li>å¯¹ä¸»è§’æ€åº¦ï¼šè­¦æƒ•</li>
                                        <li>å¤‡æ³¨ï¼šå·²å¯Ÿè§‰ä¸»è§’å¼‚å¸¸</li>
                                    </ul>
                                </div>
                            </div>
                            <div style="flex:1 1 180px;min-width:180px;max-width:220px;background:rgba(122,138,153,0.10);border:1.5px solid #7a8a99;border-radius:10px;box-shadow:0 1px 6px #7a8a9930;padding:14px 12px 10px 12px;display:flex;align-items:center;">
                                <div class="avatar-box" style="width:40px;height:40px;border-radius:50%;background:#7a8a99;display:flex;align-items:center;justify-content:center;box-shadow:0 1px 6px #7a8a9950;font-size:16px;color:#fff;font-weight:bold;flex-shrink:0;cursor:pointer;position:relative;" title="ç‚¹å‡»æ›´æ¢å¤´åƒ">
                                    <span class="avatar-text" style="user-select:none;">èµµæ˜</span>
                                    <img class="avatar-img" src="" style="display:none;width:100%;height:100%;object-fit:cover;border-radius:50%;" />
                                    <span style="position:absolute;right:1px;bottom:1px;font-size:11px;color:#fff;background:#0006;border-radius:50%;padding:0 2px;">âœ</span>
                                </div>
                                <div style="margin-left:12px;flex:1;">
                                    <div style="font-size:15px;font-weight:bold;color:#7a8a99;">èµµæ˜ <span style="font-size:12px;color:#888;">ï¼ˆå†…é—¨æ‰§äº‹ï¼‰</span></div>
                                    <ul style="list-style:none;padding:0;margin:0 0 2px 0;font-size:13px;color:#444;">
                                        <li>ä¿®ä¸ºï¼šé‡‘ä¸¹ä¸­æœŸ</li>
                                        <li>æ€§æ ¼ï¼šå†·é™ã€å–„äºè§‚å¯Ÿ</li>
                                        <li>å¯¹ä¸»è§’æ€åº¦ï¼šæš—ä¸­å…³æ³¨</li>
                                        <li>å¤‡æ³¨ï¼šæ€€ç–‘ä¸»è§’èº«ä»½</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="margin-top:18px;color:#888;font-size:13px;">
                    å½“å‰ç³»ç»Ÿï¼š{user}
                </div>
            </div>
            <div class="modal-actions">
                <button class="tool-button" onclick="this.closest('.modal').remove()">å…³é—­</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);

    // å¤´åƒäº‹ä»¶ç»‘å®š
    const avatarMap = [
        { name: "ä¸»è§’", sel: ".modal .avatar-box:nth-of-type(1)" },
        { name: "æé•¿é£", sel: ".modal .avatar-box:nth-of-type(2)" },
        { name: "èµµæ˜", sel: ".modal .avatar-box:nth-of-type(3)" }
    ];
    avatarMap.forEach(({ name, sel }) => {
        const el = modal.querySelector(sel);
        if (!el) return;
        // æ˜¾ç¤ºå·²ä¸Šä¼ å¤´åƒ
        if (avatarData[name]) {
            el.querySelector('.avatar-img').src = avatarData[name];
            el.querySelector('.avatar-img').style.display = '';
            el.querySelector('.avatar-text').style.display = 'none';
        }
        el.onclick = () => setAvatar(name, el);
    });
};
// æŸ¥çœ‹å±æ€§å¼¹çª—
function viewStats() {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    modal.innerHTML = `
        <div class="modal-content" style="min-width: 520px;max-width:95vw;">
            <h2 class="modal-title">å±æ€§è¯¦æƒ…</h2>
            <div class="modal-body" style="max-height:60vh;overflow-y:auto;">
                <div style="display:flex;gap:24px;flex-wrap:wrap;">
                    <!-- ä¸»è§’å¡ç‰‡ -->
                    <div style="flex:1 1 220px;min-width:220px;max-width:320px;background:rgba(122,138,153,0.10);border:2px solid #7a8a99;border-radius:12px;box-shadow:0 2px 12px #7a8a9930;padding:20px 18px 16px 18px;display:flex;align-items:center;">
                        <div style="width:56px;height:56px;border-radius:50%;background:#7a8a99;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px #7a8a9950;font-size:26px;color:#fff;font-weight:bold;flex-shrink:0;">
                            ä¸»è§’
                        </div>
                        <div style="margin-left:18px;flex:1;">
                            <div style="font-size:18px;font-weight:bold;color:#7a8a99;margin-bottom:2px;">ä¸»è§’ï¼ˆ{char}ï¼‰</div>
                            <div style="font-size:15px;margin-bottom:8px;color:#4d4d4d;">é’äº‘å®—å¤–é—¨å¼Ÿå­</div>
                            <ul style="list-style:none;padding:0;margin:0 0 8px 0;font-size:14px;color:#444;">
                                <li>å§“åï¼š{char}</li>
                                <li>ä¿®ä¸ºï¼šç‚¼æ°”ä¸ƒå±‚</li>
                                <li>å¤©èµ‹ï¼šå‰‘é“æ‚Ÿæ€§æé«˜</li>
                                <li>ç‰¹æ®Šï¼šèº«è´Ÿå¼‚å®</li>
                                <li>ä¿¡ä»»åº¦ï¼š<span style="color:#7a8a99;font-weight:bold;">78%</span></li>
                            </ul>
                        </div>
                    </div>
                    <!-- NPCå¡ç‰‡ -->
                    <div style="flex:2 1 320px;min-width:220px;">
                        <div style="font-size:16px;color:#7a8a99;font-weight:bold;margin-bottom:8px;margin-top:8px;">NPCåˆ—è¡¨</div>
                        <div style="display:flex;gap:16px;flex-wrap:wrap;">
                            <div style="flex:1 1 180px;min-width:180px;max-width:220px;background:rgba(191,167,130,0.10);border:1.5px solid #bfa782;border-radius:10px;box-shadow:0 1px 6px #bfa78230;padding:14px 12px 10px 12px;display:flex;align-items:center;">
                                <div style="width:40px;height:40px;border-radius:50%;background:#bfa782;display:flex;align-items:center;justify-content:center;box-shadow:0 1px 6px #bfa78250;font-size:16px;color:#fff;font-weight:bold;flex-shrink:0;">
                                    æé•¿
                                </div>
                                <div style="margin-left:12px;flex:1;">
                                    <div style="font-size:15px;font-weight:bold;color:#bfa782;">æé•¿é£ <span style="font-size:12px;color:#888;">ï¼ˆå¤–é—¨ç®¡äº‹ï¼‰</span></div>
                                    <ul style="list-style:none;padding:0;margin:0 0 2px 0;font-size:13px;color:#444;">
                                        <li>ä¿®ä¸ºï¼šç­‘åŸºåˆæœŸ</li>
                                        <li>æ€§æ ¼ï¼šä¸¥å‰ã€è°¨æ…</li>
                                        <li>å¯¹ä¸»è§’æ€åº¦ï¼šè­¦æƒ•</li>
                                        <li>å¤‡æ³¨ï¼šå·²å¯Ÿè§‰ä¸»è§’å¼‚å¸¸</li>
                                    </ul>
                                </div>
                            </div>
                            <div style="flex:1 1 180px;min-width:180px;max-width:220px;background:rgba(122,138,153,0.10);border:1.5px solid #7a8a99;border-radius:10px;box-shadow:0 1px 6px #7a8a9930;padding:14px 12px 10px 12px;display:flex;align-items:center;">
                                <div style="width:40px;height:40px;border-radius:50%;background:#7a8a99;display:flex;align-items:center;justify-content:center;box-shadow:0 1px 6px #7a8a9950;font-size:16px;color:#fff;font-weight:bold;flex-shrink:0;">
                                    èµµæ˜
                                </div>
                                <div style="margin-left:12px;flex:1;">
                                    <div style="font-size:15px;font-weight:bold;color:#7a8a99;">èµµæ˜ <span style="font-size:12px;color:#888;">ï¼ˆå†…é—¨æ‰§äº‹ï¼‰</span></div>
                                    <ul style="list-style:none;padding:0;margin:0 0 2px 0;font-size:13px;color:#444;">
                                        <li>ä¿®ä¸ºï¼šé‡‘ä¸¹ä¸­æœŸ</li>
                                        <li>æ€§æ ¼ï¼šå†·é™ã€å–„äºè§‚å¯Ÿ</li>
                                        <li>å¯¹ä¸»è§’æ€åº¦ï¼šæš—ä¸­å…³æ³¨</li>
                                        <li>å¤‡æ³¨ï¼šæ€€ç–‘ä¸»è§’èº«ä»½</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="margin-top:18px;color:#888;font-size:13px;">
                    å½“å‰ç³»ç»Ÿï¼š{user}
                </div>
            </div>
            <div class="modal-actions">
                <button class="tool-button" onclick="this.closest('.modal').remove()">å…³é—­</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

// ä¸‹æ‹‰æ¡†åˆ‡æ¢æ˜¾ç¤ºè¾“å…¥æ¡†
function toggleConsequenceInput() {
    const select = document.getElementById('newTaskConsequenceSelect');
    const input = document.getElementById('newTaskConsequenceInput');
    if (select.value === "å…¶ä»–") {
        input.style.display = "";
    } else {
        input.style.display = "none";
        input.value = "";
    }
}

function toggleTaskDone(idx) {
    tasks[idx].done = !tasks[idx].done;
    document.querySelector('.modal').remove();
    openTaskList();
}

function deleteTask(idx) {
    if (confirm('ç¡®å®šè¦åˆ é™¤è¯¥ä»»åŠ¡å—ï¼Ÿ')) {
        tasks.splice(idx, 1);
        document.querySelector('.modal').remove();
        openTaskList();
    }
}
document.addEventListener('DOMContentLoaded', function() {
   var btn = document.getElementById('memoryEditBtn');
   if(btn) {
       btn.onclick = function() {
           var modal = document.getElementById('memoryEditModal');
           if(modal) modal.style.display = 'block';
       }
   }
});
// è‡ªåŠ¨éšè—å…³é”®å‰§æƒ…ç‚¹æç¤º
document.addEventListener('DOMContentLoaded', function() {
    var prompt = document.querySelector('.intervention-prompt');
    if(prompt) {
        prompt.style.opacity = '1';
        setTimeout(function() {
            prompt.style.opacity = '0';
            setTimeout(function() {
                prompt.style.display = 'none';
            }, 500);
        }, 3000);
    }
});
</script>
</body>
</html>
